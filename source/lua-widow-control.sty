% lua-widow-control
% https://github.com/gucci-on-fleek/lua-widow-control
% SPDX-License-Identifier: MPL-2.0+
% SPDX-FileCopyrightText: 2021 gucci-on-fleek

% This file can be imported as a \LaTeX{} package, or it can be \\input'ed in
% Plain \TeX{}, so we need to detect the format for further processing.
\newif\ifLaTeX
\expandafter\ifx\csname NeedsTeXFormat\endcsname
    \LaTeXtrue
\fi

\ifLaTeX
    \NeedsTeXFormat{LaTeX2e}[2015/01/01] % Formats built after 2015 include \LuaTeX{}Base
    \ProvidesPackage{lua-widow-control}[2021/06/24 v0.00]
\else
    \input ltluatex % \LuaTeX{}Base
\fi

\clubpenalty=3
\widowpenalty=5

\directlua{require "lua-widow-control"}

% Here, we enable font expansion/contraction. It isn't strictly necessary for
% \lwc/'s functionality; however, it is required for the
% lengthened paragraphs to not have terrible spacing. 
\ifLaTeX
    \RequirePackage[final]{microtype}
\else
    \expandglyphsinfont\the\font 20 20 5
    \adjustspacing=2
\fi

\def\LuaWidowControlEnable{\directlua{lwc.enable_callbacks()}}
\def\LuaWidowControlDisable{\directlua{lwc.disable_callbacks()}}

% Enable \lwc/ by default when the package is loaded.
\LuaWidowControlEnable

\endinput
